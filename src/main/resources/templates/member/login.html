<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<link rel="stylesheet" href="../css/login.css">
<body>
<div class="login-wrap">
    <div class="login-html">
        <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1" class="tab">Sign In</label>
        <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">Sign Up</label>
        <div class="login-form">
            <form id="loginForm">
                <div class="sign-in-htm">
                    <div class="group">
                        <label for="loginEmail" class="label">Email</label>
                        <input id="loginEmail" type="text" class="input" required>
                    </div>
                    <div class="group">
                        <label for="loginPassword" class="label">Password</label>
                        <input id="loginPassword" type="password" class="input" required>
                    </div>
                    <div class="group">
                        <input id="check" type="checkbox" class="check" checked>
                        <label for="check"><span class="icon"></span> Keep me Signed in</label>
                    </div>
                    <div class="group">
                        <input type="submit" class="button" value="Sign In">
                    </div>
                    <div class="hr"></div>
                    <div class="foot-lnk">
                        <a href="#forgot">Forgot Password?</a>
                    </div>
                </div>
            </form>
            <div class="sign-up-htm">
                <div class="group">
                    <label for="name" class="label">Username</label>
                    <input id="name" type="text" class="input">
                </div>
                <div class="group">
                    <label for="passsword" class="label">Password</label>
                    <input id="passsword" type="password" class="input" data-type="password">
                </div>
                <div class="group">
                    <label for="confirmPass" class="label">Repeat Password</label>
                    <input id="confirmPass" type="password" class="input" data-type="password">
                </div>
                <div class="group">
                    <label for="email" class="label">Email Address</label>
                    <input id="email" type="text" class="input">
                </div>
                <div class="group">
                    <input type="submit" class="button" value="Sign Up">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
         event.preventDefault(); // 기본 제출 동작 방지

         const email = document.getElementById('loginEmail').value;
         const password = document.getElementById('loginPassword').value;

         const requestData = {
             email: email,
             password: password
         };

         try {
             const response = await fetch('/auth/login', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json'
<!--                     'Authorization': `Bearer ${accessToken}` // JWT 토큰 포함-->
                 },
                 body: JSON.stringify(requestData),
                 credentials: 'include'
             });

         if (response.ok) {
             const data = await response.json();
             console.log('로그인 성공:', data);
             alert('로그인 성공! 환영합니다.');

             // JWT 토큰을 쿠키에 설정하는 코드 추가
             document.cookie = `accessToken=${data.accessToken}; Path=/; HttpOnly; Secure`;

             // 성공 시 리다이렉션
             window.location.href = '/'; // 성공 후 메인 페이지로 이동
             } else {
                 const error = await response.json();
                 console.log('로그인 실패:', error);
                 alert(`로그인 실패: ${error.message || '알 수 없는 오류가 발생했습니다.'}`);
             }
         } catch (error) {
             console.error('서버 오류:', error);
             alert('서버와의 통신 중 오류가 발생했습니다. 다시 시도해주세요.');
         }
     });
</script>
</body>
</html>
